{{ $schemes := slice }}
{{ $schemesData := newScratch }}
{{ $ignore := slice "ocean" }}
{{ range resources.Match "css/schemes/*.css" }}
	{{ $name := path.BaseName .RelPermalink }}
	{{ if in $ignore $name }}
		{{ continue }}
	{{ end }}
	{{ $schemes = $schemes | append $name }}
	{{ $schemesData.SetInMap "data" $name .Content }}
{{ end }}
{{ $schemesDataFinal := $schemesData.Get "data" }}


<div class="inline-block">
	<ul
		id="schemeMenu"
		role="tablist"
		class="m-0 flex max-w-full list-none flex-wrap gap-2 p-0"
		data-schemes="{{ jsonify $schemesDataFinal }}">
		{{ range sort $schemes }}
			{{ $active := eq . (site.Params.themeColorScheme | default `blowfish`) }}
			<li
				role="tab"
				aria-selected="{{ cond $active `true` `false` }}"
				data-scheme-name="{{ . }}"
				class="{{ if $active -}}
					outline-2 outline-offset-2 outline-accent-500
				{{- end }} cursor-pointer list-none rounded-md border border-black/20 bg-white px-3 py-2 text-center text-sm hover:border-black/40 dark:border-white/20 dark:bg-white/10 dark:hover:border-white/40 dark:hover:bg-white/20">
				{{ . }}
			</li>
		{{ end }}
	</ul>
</div>

<div id="configPreview">
	{{ $defaultScheme := site.Params.themeColorScheme | default "blowfish" }}
	{{ $configCode := printf "params:\n  themeColorScheme: %s" $defaultScheme }}
	<div class="highlight-wrapper">
		<div class="codeblock-title">
			{{- "hugo.yaml" -}}
		</div>
		{{- transform.Highlight $configCode "yaml" -}}
	</div>
</div>

<style id="dynamicScheme"></style>

<script>
	(function () {
		const menu = document.getElementById('schemeMenu');
		const schemes = JSON.parse(menu.dataset.schemes);
		const styleEl = document.getElementById('dynamicScheme');
		const preview = document.getElementById('configPreview');

		let currentScheme = menu.querySelector('[data-scheme-name].outline')?.dataset.schemeName;
		styleEl.textContent = schemes[currentScheme];

		menu.querySelectorAll('[data-scheme-name]').forEach((item) => {
			item.addEventListener('click', function (e) {
				menu
					.querySelectorAll('[data-scheme-name]')
					.forEach((i) => i.classList.remove('outline-2', 'outline-offset-2', 'outline-accent-500'));

				e.target.classList.add('outline-2', 'outline-offset-2', 'outline-accent-500');

				currentScheme = e.target.dataset.schemeName;
				styleEl.textContent = schemes[currentScheme];

				const ntSpans = preview.querySelectorAll('span.nt');
				for (let i = 0; i < ntSpans.length; i++) {
					if (ntSpans[i].textContent === 'themeColorScheme') {
						const lSpan = ntSpans[i].parentElement.querySelector('span.l');
						if (lSpan) lSpan.textContent = currentScheme;
						break;
					}
				}
			});
		});
	})();
</script>
